

@{
    ViewBag.Title = "Monthly Travel Sheet";
}


@Html.Hidden("viewDocNum", (object)ViewBag.DocNum)
@Html.Hidden("viewEmpID", (object)ViewBag.EmpID)
@Html.Hidden("isView", (object)ViewBag.isView)

@Html.Hidden("EmpID", 0)
@Html.Hidden("IsSuper", false);


<div class="pcoded-content">
    <div class="card p-20" style="min-height: 495px;">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="page-header-title">
                            <h4> Monthly Travel Sheet </h4>
                        </div>
                    </div>
                    <div class="col-md-6 text-md-right">
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"> Travel Management </a></li>
                            <li class="breadcrumb-item"> Monthly Travel Sheet </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <!-- [ Main Content ] start -->
        <div class="row" id="topButton">
            <div class="col-lg-12">
                <div class="form-group">
                    <div class="text-right">
                        <button id="new" class="plus-icon"> <i class="fas fa-plus-square"></i> </button>
                        <button id="find" class="find-icon" data-toggle="modal" onclick='GeneratePopupFindGrid();' data-target="#myModal_Find"> <i class="fas fa-search"></i> </button>
                        <button id="first" class="step-backword-icon"> <i class="fas fa-step-backward"></i></button>
                        <button id="previous" class="backword-icon"> <i class="fas fa-backward"></i> </button>
                        <button id="next" class="forward-icon"> <i class="fas fa-forward"></i> </button>
                        <button id="last" class="step-forward-icon"> <i class="fas fa-step-forward"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1"> Employee Code: </label>
                    <input type="text" class="form-control frm-cstm" id="employeeCode" placeholder="Employee Code" readonly />
                </div>
            </div>

            <div class="col-lg-3">
                <div class="form-group">
                    <label for="typeCost"> Document Status: </label>
                    <input type="text" class="form-control frm-cstm" id="docStatus" placeholder="Document Status" disabled="disabled">
                </div>
            </div>
            <div class="col-lg-3">

                <div class="form-group">
                    <label for="typeCost"> Document Number: </label>
                    <input type="text" class="form-control frm-cstm" id="docNumber" placeholder="Doc Num" disabled="disabled">
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Employee Name: </label>
                    <input type="text" class="form-control frm-cstm" id="employeeName" placeholder="Employee Name" readonly />
                </div>
            </div>

            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Doc Date </label>
                    <div id="docDate"></div>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Department: </label>
                    <input type="text" class="form-control frm-cstm" id="department" placeholder="Department" readonly />
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1"> Year: </label>
                    <div id="yearDropDown" class="form-control frm-cstm"></div>
                </div>
            </div>


        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Designation: </label>
                    <input type="text" class="form-control frm-cstm" id="designation" placeholder="Designation" readonly />
                </div>
            </div>


            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Month: </label>
                    <div id="monthDropDown" class="form-control frm-cstm"></div>
                </div>
            </div>

           
        </div>
        



        <div class="row">
            <div class="col-lg-12">
                <div class="form-group">
                    <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link text-uppercase active" id="user-tab" data-toggle="tab" href="#general" role="tab" aria-controls="user" aria-selected="true"> General </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-uppercase" id="group-tab" data-toggle="tab" href="#attachment" role="tab" aria-controls="group" aria-selected="false"> Attachment </a>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade active show" id="general" role="tabpanel" aria-labelledby="user-tab">
                            <div class="card-body pt-0 pb-0">
                                <div class="table-responsive">
                                    <div id="gridContainer"></div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="tab-pane fade" id="attachment" role="tabpanel" aria-labelledby="group-tab">
                            <div class="row">
                                <div class="col-lg-8">

                                </div>


                                <div class="col-lg-4">
                                    <div class="card-body pt-0 pb-0">
                                        <div class="demo-container">
                                            <div id="fileuploader">
                                                <div class="widget-container">
                                                    <div id="file-uploader"></div>
                                                    <div class="content" id="selected-files">
                                                        <div>
                                                            @*<h4>Selected Files</h4>*@
                                                         
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                           
                            <div class="row">
                                <div class="col-lg-12">
                                    <div id="gridImageContainer"></div>
                                </div>
                                
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-8">

            </div>


            <div class="col-lg-4">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Total Amount: </label>
                    <input type="text" class="form-control frm-cstm" id="totalAmount" placeholder="Total Amount" value="0" readonly />
                </div>
            </div>


        </div>

        <div class="row">
            <div class="col-lg-12 text-right mt-3">
                <input type="button" value="Save" id="save" class="btn btn-secondary" />
                <input type="button" value="Submit" id="submit" class="btn btn-primary" />
                @{
                    TMSDeloitte.Models.UserSession sess = null;
                    if ((TMSDeloitte.Models.UserSession)HttpContext.Current.Session["TMSUserSession"] != null)
                    {
                        sess = (TMSDeloitte.Models.UserSession)HttpContext.Current.Session["TMSUserSession"];
                        if (sess.SessionUser.ISSUPER)
                        {
                            <button type="button" id="showLog" class="btn btn-success" data-toggle="modal" onclick='loadAuthLogData("/MonthlyTravelSheet/GeMonthlyTravelSheetLog");' data-target="#myLogModal">Show Log</button>
                        }

                        var menu = sess.pagelist.Where(x => x.ID == (int)TMSDeloitte.Helper.Enums.FormsName.MonthlyTravelManagement).FirstOrDefault();
                        if (menu != null)
                        {
                            <input type="hidden" id="AuthID" name="AuthID" value="@menu.Role">
                        }
                        else
                        {
                            <input type="hidden" id="AuthID" name="AuthID" value="-1">
                        }
                    }

                }


            </div>
        </div>


        <!-- [ Main Content ] end -->
    </div> <!-- [ Card Content ] end -->
</div>


<div id="myModal_Confirmation" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                Confirmation
                <button type="button" class="close" data-dismiss="modal">×</button>

            </div>
            <div class="modal-body">
                Are you sure want to remove?
            </div>
            <div class="modal-footer">
                <button type="button" id="btnYes" _name="" class="btn btn-primary">Yes</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

<div id="myModal_Find" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>

            </div>
            <div class="modal-body">
                <div id="FindContainer"></div>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnOk" class="btn btn-primary">Ok</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div id="myLogModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                @*<h4 class="modal-title">Log</h4>*@
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>

            <div class="modal-body">
                <h8>Header Log</h8>
                <div id="HeaderLogContainer"></div>
            </div>
            <div class="modal-body">
                <h8>Detail Log</h8>
                <div id="DetailLogContainer"></div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">

        var Table = [];
        var serialNo = 0;
        var year = "";
        var DocNum = "";
        var DocId = 0;
        var DocIsDeleted = false;
        var allDocList = [];
        var allLocList = [];
        var index = 1;
        var EmpCode = "0";
        var HcmOneID = 0;
        var startDate;
        var endDate;
        var locationList = [];
        var assignmentList = [];
        var taskList = [];
        var periodList = [];
        var statusList = [];
        var monthList = [];
        var gridInstance;
        var popupFindInstance;
        var fileUploader;
        var isDateRangeError = false;
        var ImageTable = [];

        function GetDocList() {
            var url = "/MonthlyTravelSheet/GetDocList";
            $.ajax({
                url: url,
                method: "GET",
                data: {},
                async: false
            }).done(function (data) {

                allDocList = data.docList;
                statusList = data.statusList;
                allLocList = data.LocationList;

                $("#employeeCode").val(data.EmpCode);
                $("#employeeName").val(data.EmpFullName);
                $("#department").val(data.Department);
                $("#designation").val(data.Designation);
                if ($("#EmpID").val() == 0)
                    $("#EmpID").val(data.EmpID);
                $("#IsSuper").val(data.IsSuper);

            }).fail(function (data) {
            });
        }

        function GenerateFileUploader()
        {
            var Year = $("#yearDropDown").dxSelectBox("instance").option('value');
            var Month = $("#monthDropDown").dxSelectBox("instance").option('value');

            if (Month == null)
            {
                AlertToast('error', "Please select month!");
                return;
            }
            var url = "/MonthlyTravelSheet/UploadImages?year=" + Year + "&month="+Month;
            fileUploader = $("#file-uploader").dxFileUploader({
                multiple: true,
                accept: "*",
                value: [],
                uploadMode: "instantly",
                uploadUrl:url, //"https://js.devexpress.com/Demos/NetCore/FileUploader/Upload",
                onValueChanged: function (e) {
                    $('.dx-fileuploader-files-container').css('display', 'none');
                },
                onUploaded: function (e) {

                    var fileName = e.file.name;
                    var filePath = JSON.parse(e.request.responseText);
                    var sno = ImageTable.length;
                    $("#selected-files .selected-item").remove();
                    var dataExist = ImageTable.filter(x=>x.Name == fileName);
                    if (dataExist.length == 0) {
                        sno = sno + 1;
                        var Details = {
                            SNo: sno,
                            Name: fileName,
                            ImagePath: filePath.url
                        };

                        ImageTable.push(Details);
                    }
                    GenerateImageGrid(ImageTable);

                },
               
            }).dxFileUploader("instance");
        }

        function GenerateDateBox()
        {
            var now = new Date();

            $("#docDate").dxDateBox({
                type: "date",
                pickerType: "calendar",
                value: now,
                displayFormat: "dd/MM/yyyy",
                onValueChanged: function (data) {
                    // $("#toDate").dxDateBox({min: data.value});
                   
                }
            });


            $('.dx-texteditor-input').attr('readonly', true);
        }

        function GenerateYearMonthDropDown() {

            var min = new Date().getFullYear();
            min = min - 1;
            var max = min + 9;;
            var yearList = [];
            var year = {};
            for (var i = min; i <= max; i++) {
                year = { value: i };
                yearList.push(year);
            }

            $("#yearDropDown").dxSelectBox({
                value: yearList[0].value,
                cacheEnabled: false,
                items: yearList,
                displayExpr: "value",
                valueExpr: "value",
                placeholder: "Select Year...",
                cssclass: "form-control frm-cstm",
                //searchEnabled: true,
                readonly: false,
                onValueChanged: function (data) {
                    var month = $("#monthDropDown").dxSelectBox("instance").option('value');
                    if (month != null || month != undefined)
                    GetMonthFirstAndLastDate(data.value,month);
                }
            });

            var date = new Date();

            $("#monthDropDown").dxSelectBox({
                //value: date.getMonth() + 1,
                cacheEnabled: false,
                items: monthList,
                displayExpr: "Name",
                valueExpr: "ID",
                placeholder: "Select Month...",
                cssclass: "form-control frm-cstm",
                searchEnabled: true,
                readonly: false,
                onValueChanged: function (data) {
                    var year = $("#yearDropDown").dxSelectBox("instance").option('value');
                    if (year != null || year != undefined)
                        GetMonthFirstAndLastDate(year, data.value);


                    GenerateFileUploader();
                }
            });

        }

        function convertDate(inputFormat) {
            function pad(s) { return (s < 10) ? '0' + s : s; }
            var d = new Date(inputFormat)
            return [pad(d.getDate()), pad(d.getMonth() + 1), d.getFullYear()].join('/')
        }

        function GetMonthFirstAndLastDate(year, month) {

           
            Table = [];
            serialNo = 0;
            GenerateGrid([]);
            GenerateImageGrid([]);

            var date = new Date(year + '/' + month + '/01');

            startDate = new Date(date.getFullYear(), date.getMonth(), 1);

            endDate = new Date(date.getFullYear(), date.getMonth() + 1, 0);

            GetEmpMonthlyTravelSheet();
        }

        function GetData()
        {
            monthList = [{
                "ID": 1,
                "Name": "January"
            },
               {
                   "ID": 2,
                   "Name": "February "
               }
               ,
               {
                   "ID": 3,
                   "Name": "March"
               }
               ,
               {
                   "ID": 4,
                   "Name": "April"
               }
               ,
               {
                   "ID": 5,
                   "Name": "May"
               }
               ,
               {
                   "ID": 6,
                   "Name": "June"
               }
               ,
               {
                   "ID": 7,
                   "Name": "July"
               }
               ,
               {
                   "ID": 8,
                   "Name": "August"
               }
               ,
               {
                   "ID": 9,
                   "Name": "September"
               }
               ,
               {
                   "ID": 10,
                   "Name": "October"
               }
               ,
               {
                   "ID": 11,
                   "Name": "November"
               }
               ,
               {
                   "ID": 12,
                   "Name": "December"
               }
            ];

               assignmentList = [{
                    "ID": 1,
                    "Name": "Assignment 1"
                }, {
                    "ID": 2,
                    "Name": "Assignment 2"
                }, {
                    "ID": 3,
                    "Name": "Assignment 3"
                }, {
                    "ID": 4,
                    "Name": "Assignment 4"
                }, {
                    "ID": 5,
                    "Name": "Assignment 5"
                }];

               taskList = [{
                    "ID": 1,
                    "Name": "Task 1 - NC",
                    "AssignmentID": 1,
                   "NonChargeable":true
                }, {
                    "ID": 2,
                    "Name": "Task 2 - C",
                    "AssignmentID": 1,
                    "NonChargeable": false
                }, {
                    "ID": 3,
                    "Name": "Task 3 - NC",
                    "AssignmentID": 1,
                    "NonChargeable": true
                }, {
                    "ID": 4,
                    "Name": "Task 4 - C",
                    "AssignmentID": 1,
                    "NonChargeable": false
                }, {
                    "ID": 5,
                    "Name": "Task 5 - NC",
                    "AssignmentID": 2,
                    "NonChargeable": true
                }, {
                    "ID": 6,
                    "Name": "Task 6 - C",
                    "AssignmentID": 2,
                    "NonChargeable": false
                }, {
                    "ID": 7,
                    "Name": "Task 7 - NC",
                    "AssignmentID": 2,
                    "NonChargeable": true
                }, {
                    "ID": 8,
                    "Name": "Task 8 - C",
                    "AssignmentID": 3,
                    "NonChargeable": false
                }, {
                    "ID": 9,
                    "Name": "Task 9 - NC",
                    "AssignmentID": 3,
                    "NonChargeable": true
                }, {
                    "ID": 10,
                    "Name": "Task 10 - C",
                    "AssignmentID": 3,
                    "NonChargeable": false
                }, {
                    "ID": 11,
                    "Name": "Task 11 - NC",
                    "AssignmentID": 4,
                    "NonChargeable": true
                }, {
                    "ID": 12,
                    "Name": "Task 12 - C",
                    "AssignmentID": 4,
                    "NonChargeable": false
                }, {
                    "ID": 13,
                    "Name": "Task 13 - NC",
                    "AssignmentID": 4,
                    "NonChargeable": true
                }, {
                    "ID": 14,
                    "Name": "Task 14 - C",
                    "AssignmentID": 4,
                    "NonChargeable": false
                }, {
                    "ID": 15,
                    "Name": "Task 15 - NC",
                    "AssignmentID": 4,
                    "NonChargeable": true
                }, {
                    "ID": 16,
                    "Name": "Task 16 - C",
                    "AssignmentID": 5,
                    "NonChargeable": false
                }, {
                    "ID": 17,
                    "Name": "Task 17 - NC",
                    "AssignmentID": 5,
                    "NonChargeable": true
                }, {
                    "ID": 18,
                    "Name": "Task 18 - C",
                    "AssignmentID": 5,
                    "NonChargeable": false
                }, {
                    "ID": 19,
                    "Name": "Task 19 - NC",
                    "AssignmentID": 5,
                    "NonChargeable": true
                }, {
                    "ID": 20,
                    "Name": "Task 20 - C",
                    "AssignmentID": 5,
                    "NonChargeable": false
                }];


            }


        function GetUserInfoByEmpCode(empCode) {
            loadPanel.show();
            var url = "/MonthlyTravelSheet/GetUserInfoByEmpCode";
            $.ajax({
                url: url,
                method: "GET",
                async: false,
                data: { empCode: empCode },
            }).done(function (response) {
                $("#employeeName").val("");

                if (response.Success) {
                    $("#employeeName").val(response.UserInfo.FULLNAME);
                }


                loadPanel.hide();

            }).fail(function (data) {
                loadPanel.hide();
            });
        }

        function GetLogData(url) {
            loadData(url+"?docNum=" + DocNum);
        }

        function GenerateGrid(JSON_Response) {
            gridInstance= $("#gridContainer").dxDataGrid({
                dataSource: JSON_Response,
                keyExpr: "KEY",
                columnAutoWidth: true,
                allowColumnResizing: true,
                allowColumnReordering: true,
                showBorders: true,
                showScrollbar: 'always',
                filterRow: { visible: true },
                editing: {
                    mode: "cell",
                    allowUpdating: true
                },
                scrolling: {
                    mode: "horizontal",
                    showScrollbar: 'always'
                },
                paging: { pageSize: 10 },
                //editing: {
                //    mode: "batch",
                //    allowUpdating: true,
                //    allowDeleting: true,
                //    allowAdding: true
                //},
                columns: [
                    {
                        dataField: "ID",
                        visible:false,
                    },
                    {
                        dataField: "HeaderID",
                        visible: false,
                    },
                    {
                        dataField: "ClientID",
                        visible: false,
                    },
                    {
                        dataField: "SNo",
                        caption: "S.No",
                        dataType: "number",
                        allowEditing: false,
                        width:"45"
                    },
                     {
                         dataField: "_TravelDate",
                         allowEditing: false,
                         visible: false,
                     },
                    {
                        dataField: "TravelDate",
                        caption: "Work Date",
                        validationRules: [{ type: "required" }],
                        dataType: 'date',
                        format: 'dd/MM/yyyy',
                        width: "90"
                    },
                     {
                         dataField: "AssignmentID",
                         caption: "AssignmentID",
                         visible: false,
                         //validationRules: [{ type: "required" }],
                         //setCellValue: function (rowData, value) {
                         //    rowData.AssignmentID = value;
                         //    rowData.TaskID = null;
                         //},
                         //lookup: {
                         //    dataSource: assignmentList,
                         //    valueExpr: "ID",
                         //    displayExpr: "Name"
                         //}
                     },
                     
                      {
                          dataField: "AssignmentTitle",
                          caption: "Assignment",
                          allowEditing: false,
                      },
                      
                      {
                          dataField: "Description",
                          caption: "Description",
                          allowEditing: true,
                      },
                      
                      
                       {
                           dataField: "LocationID",
                           caption: "Location",
                           allowEditing: false,
                           lookup: {
                               dataSource: allLocList,
                               valueExpr: "ID",
                               displayExpr: "LOCATION"
                           }
                       },
                       {
                           dataField: "ClientName",
                           caption: "Client Name",
                           allowEditing: false,
                       },
                      {
                          dataField: "Kilometers",
                          caption: "Kilometers",
                          //validationRules: [{ type: "required" }],
                          dataType: "number",
                          width: "98",
                          allowEditing: false,

                      },
                      {
                          dataField: "Amount",
                          caption: "Amount",
                          //validationRules: [{ type: "required" }],
                          dataType: "number",
                          width: "98",
                          allowEditing: false,

                      },
                      {
                          dataField: "ParkingCharges",
                          caption: "Parking Charges",
                          validationRules: [{ type: "required" }],
                          dataType: "number",
                          width: "98",
                          allowEditing: true,

                      },
                      {
                          dataField: "TotalAmount",
                          caption: "Total Amount",
                          dataType: "number",
                          width: "98",
                          allowEditing: false,

                      },
                      {
                          dataField: "IsDeleted",
                          allowEditing: true,
                          allowEditing: false,
                          visible: false,
                          dataType: 'boolean',
                      },
                ],
                onCellPrepared: function (options) {
                    options.cellElement.find('.dx-datebox').dxDateBox("option", "min", new Date(startDate));
                    options.cellElement.find('.dx-datebox').dxDateBox("option", "max", new Date(endDate));
                },
                onInitNewRow: function (e) {
                    e.data.ID = 0;
                    serialNo = serialNo + 1;
                    e.data.SNo = serialNo;
                    e.data.Kilometers = 15;
                    e.data.Amount = 50;
                    //e.data.ParkingCharges = 50;
                    e.data.TotalAmount = 0;
                    e.data.IsDeleted = false;
                    
                },
                onRowPrepared: function (e) {

                   
                } , 
                onEditorPreparing: function (e) {
                    
                    //if (e.parentType === "dataRow" && e.dataField === "ParkingCharges") {
                    //    e.editorOptions.onValueChanged = args => {
                    //        e.setValue(args.value);
                    //        SaveGridAndCalculate();
                    //    };
                    //}

                   
                    if (e.parentType == "dataRow" && e.dataField === "ParkingCharges") {
                        var valueChangedHandler = e.editorOptions.onValueChanged;
                        e.editorOptions.onValueChanged = function (args) {
                            valueChangedHandler(args); // default logic
                            setTimeout(() => {
                                var totalAmount = 0;
                                var index = 0;
                                var grid = $("#gridContainer").dxDataGrid("instance");
                                e.component.getVisibleRows().forEach(row => {
                                    
                                    if (row.rowType === "data") {
                                        if (row.data.Amount != undefined && row.data.ParkingCharges != undefined)
                                        {
                                            totalAmount = totalAmount + (row.data.Amount + row.data.ParkingCharges);
                                            grid.cellValue(index, "TotalAmount", row.data.Amount + row.data.ParkingCharges);
                                        }
                                       
                                        index = index + 1;
                                    }
                                });
                                $("#totalAmount").val(totalAmount);
                                $('.dx-link-delete').click(DeleteGridRow);

                                SaveGridAndCalculate();
                            });
                        };
                    }
                },
                onEditorPrepared: function (e) {
                   

                  
                },
                onEditingStart: function (e) {
                },
                onRowInserting: function (e) {

                },
                onRowInserted: function (e) {

                    var dataExist = Table.filter(x=>x.KEY == e.data.KEY);
                    e.data.TotalAmount = e.data.Amount + e.data.ParkingCharges;
                    if (dataExist.length == 0)
                    {

                        var Wdate = e.data.TravelDate;
                        var Fday = Wdate.getDate();       // yields date
                        var Fmonth = Wdate.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
                        var Fyear = Wdate.getFullYear();  // yields year
                        var Fhour = Wdate.getHours();     // yields hours
                        var Fminute = Wdate.getMinutes(); // yields minutes
                        var Fsecond = Wdate.getSeconds(); // yields seconds
                        var _TravelDate = Fyear + "-" + Fmonth + "-" + Fday;

                     

                            var Details = {
                                ID: e.data.ID,
                                HeaderID: e.data.HeaderID,
                                SNO: e.data.SNo,
                                KEY: e.data.KEY,
                                _TravelDate: _TravelDate,
                                TravelDate: e.data.TravelDate,
                                AssignmentID: e.data.AssignmentID,
                                Description: e.data.Description,
                                AssignmentID: e.data.AssignmentID,
                                LocationID: e.data.LocationID,
                                ClientID: e.data.ClientID,
                                Amount: e.data.Amount,
                                ParkingCharges: e.data.ParkingCharges,
                                TotalAmount: e.data.TotalAmount,
                                IsDeleted: false
                            };

                        Table.push(Details);
                        //SaveGridAndCalculate();
                        serialNo = Table.length;
                    }
                    else
                    {
                        $.each(Table, function (index, val) {
                            var Wdate = new Date(val.TravelDate);
                            var Fday = Wdate.getDate();       // yields date
                            var Fmonth = Wdate.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
                            var Fyear = Wdate.getFullYear();  // yields year
                            var Fhour = Wdate.getHours();     // yields hours
                            var Fminute = Wdate.getMinutes(); // yields minutes
                            var Fsecond = Wdate.getSeconds(); // yields seconds
                            var _TravelDate = Fyear + "-" + Fmonth + "-" + Fday;
                            if (val.KEY == e.data.KEY) {
                                val._TravelDate = _TravelDate;
                                val.TravelDate = e.data.TravelDate;
                                val.AssignmentID = e.data.AssignmentID;
                                val.Description = e.data.Description;
                                val.Kilometers= e.data.Kilometers,
                                val.Amount= e.data.Amount,
                                val.ParkingCharges= e.data.ParkingCharges,
                                val.TotalAmount= e.data.TotalAmount,
                                val.OnSite = e.data.OnSite;
                            }

                        });
                    }


                    //Calculate();

                },
                onRowUpdating: function (e) {
                },
                onRowUpdated: function (e) {
                    var Wdate = new Date(e.data.TravelDate);
                    var Fday = Wdate.getDate();       // yields date
                    var Fmonth = Wdate.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
                    var Fyear = Wdate.getFullYear();  // yields year
                    var Fhour = Wdate.getHours();     // yields hours
                    var Fminute = Wdate.getMinutes(); // yields minutes
                    var Fsecond = Wdate.getSeconds(); // yields seconds
                    var _TravelDate = Fyear + "-" + Fmonth + "-" + Fday;

                    e.data.TotalAmount = e.data.Amount + e.data.ParkingCharges;

                    $.each(Table, function (index, val) {
                        if (val.KEY == e.data.KEY) {
                            val._TravelDate = _TravelDate;
                            val.TravelDate = e.data.TravelDate;
                            val.AssignmentID= e.data.AssignmentID;
                            val.Description = e.data.Description;
                            val.LocationID = e.data.LocationID;
                            val.ClientID = e.data.ClientID;
                            val.Kilometers= e.data.Kilometers,
                            val.Amount= e.data.Amount,
                            val.ParkingCharges= e.data.ParkingCharges,
                            val.TotalAmount= e.data.TotalAmount
                        }

                    });

                    //SaveGridAndCalculate();

                    serialNo = Table.length;

                    //Calculate();
                },
                onRowRemoving: function (e) {
                    //SaveGridAndCalculate();
                    Calculate();
                },
                onRowRemoved: function (e) {
                    $.each(Table, function (index, val) {
                        if (val.KEY == e.data.KEY) {
                            val.IsDeleted = true;
                        }
                    });

                    //SaveGridAndCalculate();
                    Calculate();
                },

            });

            //var gridContainer = $("#gridContainer").dxDataGrid("instance");
            //gridContainer.columnOption('SNo', 'sortOrder', 'desc');
            Calculate();
        }

        function GenerateImageGrid(dataSource) {
            $("#gridImageContainer").dxDataGrid({
                dataSource: dataSource,
                // keyExpr: "KEY",
                columnAutoWidth: true,
                allowColumnResizing: true,
                allowColumnReordering: true,
                showBorders: true,
                showScrollbar: 'always',
                filterRow: { visible: true },
                //editing: {
                //    mode: "cell",
                //    allowUpdating: true
                //},
                scrolling: {
                    mode: "horizontal",
                    showScrollbar: 'always'
                },
                paging: { pageSize: 20 },
                //editing: {
                //    mode: "batch",
                //    allowUpdating: true,
                //    allowDeleting: true,
                //    allowAdding: true
                //},
                columns: [
                    {
                        dataField: "SNo",
                        caption: "S.No",
                        dataType: "number"
                    },
                    {
                        dataField: "Name",
                        caption: "Name",
                    },
                    
                       {
                           dataField: "ImagePath",
                           alignment: "left",
                           caption: "View",
                           cellTemplate: function (container, options) {

                               $("<div>")
                                  .append($("<a class='btn btn_icn btnViewImage' _imagepath=" + options.data.ImagePath + " " + " title='View'><em class='fa fa-eye'></em></a>"))
                                  .appendTo(container);
                           }
                       },
                        {
                            dataField: "Name",
                            alignment: "left",
                            caption: "Remove",
                            cellTemplate: function (container, options) {
                                $("<div>")
                                   .append($("<a class='btn btn_icn btnRemoveDocument' _name=" + options.data.ImagePath + " title='Cencel'><em class='fa fa-times'></em></a>"))
                                   .appendTo(container);
                            }
                        },

                ],
                onEditorPreparing: function (e) {
                   
                },
                onEditingStart: function (e) {
                },
                onInitNewRow: function (e) {

                  

                },
                onRowInserting: function (e) {

                },
                onRowInserted: function (e) {
                    
                },
                onRowUpdating: function (e) {
                },
                onRowUpdated: function (e) {
                   
                },
                onRowRemoving: function (e) {
                },
                onRowRemoved: function (e) {
                   
                }
            });

        }

        function GetEmpMonthlyTravelSheet() {

            //if (DocNum != "")
            //    return;

            $("#docNumber").val("");
            $("#totalAmount").val("0");

            var empid = $("#EmpID").val(); //$("#empGridBox").dxDropDownBox("instance").option('value');
            var year = $("#yearDropDown").dxSelectBox("instance").option('value');
            var month = $("#monthDropDown").dxSelectBox("instance").option('value');

            var Fdate =startDate;
            var Fday = Fdate.getDate();       // yields date
            var Fmonth = Fdate.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
            var Fyear = Fdate.getFullYear();  // yields year
            var Fhour = Fdate.getHours();     // yields hours
            var Fminute = Fdate.getMinutes(); // yields minutes
            var Fsecond = Fdate.getSeconds(); // yields seconds
            var fromDate = Fyear + "/" + Fmonth + "/" + Fday;//+ " " + Fhour + ':' + Fminute + ':' + Fsecond;

            var Tdate =endDate;
            var Tday = Tdate.getDate();       // yields date
            var Tmonth = Tdate.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
            var Tyear = Tdate.getFullYear();  // yields year
            var Thour = Tdate.getHours();     // yields hours
            var Tminute = Tdate.getMinutes(); // yields minutes
            var Tsecond = Tdate.getSeconds(); // yields seconds
            var toDate = Tyear + "/" + Tmonth + "/" + Tday;//+ " " + Thour + ':' + Tminute + ':' + Tsecond;


            if (empid != null && year != null && month != null)
            {
                loadPanel.show();

                var url = "/MonthlyTravelSheet/GetEmpMonthlyTravelSheet?empID=" + empid + "&year=" + year + "&month=" + month + "&fromDate=" + fromDate + "&toDate=" + toDate;

                $.ajax({
                    url: url,
                    method: "GET",
                    data: {},
                    async: false,
                }).done(function (data) {
                    loadPanel.hide();
                    $("#docNumber").val("");
                    var jsonResponse = JSON.parse(data.response.Data);
                    if (jsonResponse.ID > 0)
                    {
                        VlidateDetails(jsonResponse);
                    }
                    else
                    {
                        Table = jsonResponse.Detail;
                        GenerateGrid(Table);
                    }
                   

                }).fail(function (data) {
                    loadPanel.hide();
                   console.log(data);
                });
            }

        }


        function SaveGridAndCalculate() {

            var gridContainer = $("#gridContainer").dxDataGrid("instance");

            gridContainer.getController('validating').validate(true).done(function (result) {
                if (result) {
                    gridContainer.saveEditData();
                    //Calculate();
                }

            });

        }


        function Calculate()
        {
            //var notSaved = $('#gridContainer').dxDataGrid('instance').getController('editing').hasChanges();
            //if (notSaved) {
            //    setTimeout(function () { Calculate(); }, 2000);
            //}
            //else
            //{
               
            //}


            var chargeAbleHours = 0;
            var nonChargeAbleHours = 0;
            var overTime = 0;
            var totalAmount = 0;
            serialNo = 0;;

            $.each(Table, function (index, val) {

                if (val.IsDeleted == false) {
                    serialNo = serialNo + 1;
                    totalAmount = totalAmount + (val.Amount + val.ParkingCharges);

                }

            });

            $("#totalAmount").val(totalAmount);
        }

        function SaveAndSubmitCall(status) {
            var isSuccess = true;
            var message = '';

            var MonthlyTravelSheetObj = {
                ID: DocId,
                Status: status,
                DocNum: $("#docNumber").val(),
                EmpID: $("#EmpID").val(),//$("#empGridBox").dxDropDownBox("instance").option('value'),
                EmpCode: $("#EmpCode").val(),// $("#empGridBox").dxDropDownBox("instance").option('text'),
                Year: $("#yearDropDown").dxSelectBox("instance").option('value'),
                Month: $("#monthDropDown").dxSelectBox("instance").option('value'),
                TotalAmount: $("#totalAmount").val()
            };
            if (MonthlyTravelSheetObj.EmpID == "") {
                isSuccess = false;
                message = 'Please select employee, ';
            }
            if (MonthlyTravelSheetObj.Year == "") {
                isSuccess = false;
                message = message + 'Please select year, ';
            }
            if (MonthlyTravelSheetObj.Month == "") {
                isSuccess = false;
                message = message + 'Please select month';
            }


            if (isSuccess) {
                loadPanel.show();
                var gridContainer = $("#gridContainer").dxDataGrid("instance");
                gridContainer.getController('validating').validate(true).done(function (result) {
                    if (result) {
                        gridContainer.saveEditData();
                        setTimeout(function () { SaveAndSubmit(status); }, 2000);
                    }
                    else {
                        loadPanel.hide();
                        AlertToast('error', "Please add require data in table!");
                    }

                });


            }
            else {
                AlertToast('error', message);
            }
        }

        function SaveAndSubmit(status) {
            var notSaved = $('#gridContainer').dxDataGrid('instance').getController('editing').hasChanges();
            if (notSaved) {
                setTimeout(function () { SaveAndSubmit(status); }, 2000);
            }
            else {

                //gridInstance= $("#gridContainer").dxDataGrid('instance');
                //gridInstance.getDataSource().store().load().done((res) => {
                //    Table = [];
                //    Table = res;
                //});
                if (Table.length == 0) {
                    loadPanel.hide();
                    AlertToast('error', "Please add record!");
                    return;
                }


                var Fdate = $("#docDate").dxDateBox("instance").option('value');
                var Fday = Fdate.getDate();       // yields date
                var Fmonth = Fdate.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
                var Fyear = Fdate.getFullYear();  // yields year
                var Fhour = Fdate.getHours();     // yields hours
                var Fminute = Fdate.getMinutes(); // yields minutes
                var Fsecond = Fdate.getSeconds(); // yields seconds
                var docdate = Fyear + "-" + Fmonth + "-" + Fday;

                var MonthlyTravelSheetObj = {
                    ID: DocId,
                    Status: status,
                    DocNum: $("#docNumber").val(),
                    EmpID: $("#EmpID").val(),//$("#empGridBox").dxDropDownBox("instance").option('value'),
                    EmpCode: $("#employeeCode").val(),// $("#empGridBox").dxDropDownBox("instance").option('text'),
                    Year: $("#yearDropDown").dxSelectBox("instance").option('value'),
                    Month: $("#monthDropDown").dxSelectBox("instance").option('value'),
                    DocDate: docdate,
                    TotalAmount: $("#totalAmount").val(),
                    Attachements: ImageTable,
                    Detail: Table
                };

                var jsonData = JSON.stringify({
                    obj : MonthlyTravelSheetObj
                });

                var url = "/MonthlyTravelSheet/AddUpdateTimeSheetPeriod";
                $.ajax({
                    type: "POST",
                    url: url,
                    contentType: 'application/json',
                    data: jsonData,
                    dataType: "json",
                    async: false,
                    success: function (response) {
                        loadPanel.hide();
                        if (response.Success) {
                            AlertToast('success', response.Message);
                            setTimeout(function () {
                                window.location.reload();
                            }, 5000);
                        }
                        else {
                            AlertToast('error', response.Message);
                        }
                    },
                    error: function (response) {
                        console.log(response);
                        loadPanel.hide();
                    },
                    failure: function (response) {
                        console.log(response);
                        loadPanel.hide();
                    }

                });

            }

        }

        function GeneratePopupFindGrid() {

            //var empid = $("#EmpID").val();
            //if (empid != null && empid != 0) { }
            loadPanel.show();
            var ur = "/MonthlyTravelSheet/GetAllDocumentsByEmpID";
            $.ajax({
                url: ur,
                method: "GET",
                data: {},
                async: false,
            }).done(function (data) {
                var JSON_Response = JSON.parse(data.response.Data);
                //console.log(JSON_Response);
                popupFindInstance = $("#FindContainer").dxDataGrid({
                    dataSource: JSON_Response,
                    keyExpr: "DocNum",
                    paging: { pageSize: 10 },
                    columnAutoWidth: true,
                    pager: { showInfo: true },
                    allowColumnResizing: true,
                    allowColumnReordering: true,
                    showBorders: true,
                    showScrollbar: 'always',
                    filterRow: { visible: true },
                    scrolling: {
                        mode: "horizontal",
                        showScrollbar: 'always'
                    },
                    selection: {
                        mode: "single"
                    },
                    columns: [
                        {
                            dataField: "ID",
                            caption: "ID",
                            visible: false
                        },
                        {
                            dataField: "DocNum",
                            caption: "Document #"
                        },
                        {
                            dataField: "Year",
                            caption: "Year"
                        },
                           {
                               dataField: "Status",
                               caption: "Status",
                               lookup: {
                                   dataSource: statusList,
                                   valueExpr: "ID",
                                   displayExpr: "Name"
                               }
                           },
                          {
                              dataField: "MonthName",
                              caption: "Month"
                          },
                          {
                              dataField: "DocDate",
                              caption: "Doc Date"
                          },
                          {
                              dataField: "TotalAmount",
                              caption: "Total Amount"
                          },
                        {
                            dataField: "CreatedDate",
                            caption: "Created Date"
                        }
                    ]
                }).dxDataGrid("instance");

                $("#select-all-mode").dxSelectBox({
                    dataSource: ["allPages", "page"],
                    value: "allPages",
                    onValueChanged: function (data) {
                        dataGrid.option("selection.selectAllMode", data.value);
                    }
                });

                $("#show-checkboxes-mode").dxSelectBox({
                    dataSource: ["none", "onClick", "onLongTap", "always"],
                    value: "onClick",
                    onValueChanged: function (data) {
                        dataGrid.option("selection.showCheckBoxesMode", data.value);
                        $("#select-all-mode").dxSelectBox("instance").option("disabled", data.value === "none");
                    }
                });

                popupFindInstance.clearSelection();

                loadPanel.hide();

            }).fail(function (data) {
                console.log(data);
                loadPanel.hide();
            });
        }

        function ValidateAuthorization() {
            var id = $("#AuthID").val();
            var isSuccess = false;

            if (id == -1)
                isSuccess = true;
            if (id == 2)
                isSuccess = true;

            if (isSuccess) {
                $("#save").remove();
                $("#submit").remove();
               // $("#gridContainer").dxDataGrid({ disabled: true });
            }
        }

        function loadAuthLogData(url) {

            if (DocId != 0) {
                url = url + "?docid=" + DocId;

                $.ajax({
                    url: url,
                    method: "GET",
                    data: {},
                    async: false,
                }).done(function (data) {
                    $("#HeaderLogContainer").dxDataGrid({
                        dataSource: JSON.parse(data.Header.Data),
                        paging: { pageSize: 10 },
                        columnAutoWidth: true,
                        pager: { showInfo: true },
                        allowColumnResizing: true,
                        allowColumnReordering: true,
                        showBorders: true,
                        showScrollbar: 'always',
                        filterRow: { visible: true },
                        scrolling: {
                            mode: "horizontal",
                            showScrollbar: 'always'
                        },
                    });
                    $("#DetailLogContainer").dxDataGrid({
                        dataSource:JSON.parse(data.Detail.Data) ,
                        paging: { pageSize: 10 },
                        columnAutoWidth: true,
                        pager: { showInfo: true },
                        allowColumnResizing: true,
                        allowColumnReordering: true,
                        showBorders: true,
                        showScrollbar: 'always',
                        filterRow: { visible: true },
                        scrolling: {
                            mode: "horizontal",
                            showScrollbar: 'always'
                        },
                    });

                }).fail(function (data) {
                    console.log(data);
                });
            }



        }

        function GetMonthlyTravelSheetByDocNum(docNum) {
           
            loadPanel.show();
            $("#totalAmount").val("0");
            Table = [];
            serialNo = 0;
            EmpCode = "0";
            HcmOneID = 0;
            startDate = "";
            endDate = "";
            var empid;
            if ($('#isView').val() == "True")
                empid = $('#viewEmpID').val();
            else
                empid = $('#EmpID').val()

            var url = "/MonthlyTravelSheet/GetMonthlyTravelSheetByDocNum?docNum=" + docNum + "&EmpID=" + empid + "&isView=" + $('#isView').val();
            $.ajax({
                url: url,
                method: "GET",
                data: {},
                async: false,
            }).done(function (data) {
                loadPanel.hide();

                DocId =0;
                DocNum ="";

                var JSON_Response = JSON.parse(data.response.Data);

                VlidateDetails(JSON_Response);


            }).fail(function (data) {
                loadPanel.hide();
                console.log(data);
            });
        }


        function VlidateDetails(JSON_Response)
        {
           

            GenerateGrid([]);
            $("#docNumber").val("");

            $("#docNumber").val(JSON_Response.DocNum);
            $("#docStatus").val(JSON_Response.StatusName);
            DocId = JSON_Response.ID;
            DocNum = JSON_Response.DocNum;

            $("#yearDropDown").dxSelectBox({ value: JSON_Response.Year });
            $("#monthDropDown").dxSelectBox({ value: JSON_Response.Month });
            $("#totalAmount").val(JSON_Response.TotalAmount);
            
            $.each(JSON_Response.Detail, function (index, val) {

                var Details = {
                    ID: val.ID,
                    HeaderID: val.HeaderID,
                    ClientID: val.ClientID,
                    SNo: val.SNo,
                    KEY: val.KEY,
                    _TravelDate: val._TravelDate,
                    TravelDate: new Date(val._TravelDate),
                    AssignmentTitle: val.AssignmentTitle,
                    AssignmentID: val.AssignmentID,
                    Description: val.Description,
                    LocationID: val.LocationID,
                    ClientName: val.ClientName,
                    Kilometers: val.Kilometers,
                    Amount: val.Amount,
                    ParkingCharges: val.ParkingCharges,
                    TotalAmount: val.TotalAmount,
                    IsDeleted: false
                };
                Table.push(Details);
                //sno = sno - 1;
            });

            GenerateGrid(Table);

            if (JSON_Response._Attachements != null) {
                if (JSON_Response._Attachements.length > 0) {
                    var array = JSON_Response._Attachements.split(',');

                    var newImageTable = [];
                    var sno = 0;
                    $.each(array, function (index, val) {
                        sno = sno + 1;
                       
                        var Details = {
                            SNo: sno,
                            Name: val,
                            ImagePath: JSON_Response._AttachementsURL + val
                        };
                        newImageTable.push(Details);
                    });

                    ImageTable = newImageTable;
                    GenerateImageGrid(ImageTable);
                }
            }
          

            serialNo = Table.length;

            $('#docNumber').prop("disabled", true);

            if (JSON_Response.Status == 2 || JSON_Response.Status == 4 || $('#isView').val() == "True") {
                $("#save").remove();
                $("#submit").remove();

                if ($('#isView').val() == "True")
                {
                    $("#showLog").remove();
                    $("#topButton").remove();
                }
                   

                //$("#gridContainer").dxDataGrid({
                //    editing: {
                //        mode: "batch",
                //        allowUpdating: false,
                //        allowDeleting: false,
                //        allowAdding: false
                //    },
                //});
            }

        }


        function DeleteGridRow(event) {
            SaveGridAndCalculate();
            return false;
        }

        $('document').ready(function () {

           

            GetDocList();
            GetData();
            GenerateDateBox();
            GenerateYearMonthDropDown();
            ValidateAuthorization();
            
            $("#yearDropDown").dxSelectBox({ value: new Date().getFullYear() });
           // $("#monthDropDown").dxSelectBox({value: new Date().getMonth() + 1 });
            GenerateGrid([]);

            if ($('#isView').val() == "True")
                GetMonthlyTravelSheetByDocNum($('#viewDocNum').val());

            $('#save').click(function () {
                SaveAndSubmitCall(1);
            });
            $('#submit').click(function () {
                SaveAndSubmitCall(2);
            });
            $('#new').click(function () {
                //DocNum = "";
                //DocId = 0;
                //Table = [];
                //$("#docNumber").val("");
                //$('#docNumber').prop("disabled", true);
                //serialNo = 0;

                window.location.reload();
            });
            $('#find').click(function () {
                $("#docNumber").val("");
                $('#docNumber').prop("disabled", false);
            });
            $('#first').click(function () {
                $('#docNumber').prop("disabled", true);
                index = 0;
                GetMonthlyTravelSheetByDocNum(allDocList[index]);
            });
            $('#last').click(function () {
                $('#docNumber').prop("disabled", true);
                index = allDocList.length - 1;
                GetMonthlyTravelSheetByDocNum(allDocList[index]);
            });
            $('#previous').click(function () {
                $('#docNumber').prop("disabled", true);
                if (index != 0)
                    index = index - 1;
                GetMonthlyTravelSheetByDocNum(allDocList[index]);
            });
            $('#next').click(function () {
                $('#docNumber').prop("disabled", true);
                if (index < allDocList.length-1)
                    index = index + 1;

                GetMonthlyTravelSheetByDocNum(allDocList[index]);
            });
            $('#btnOk').click(function () {
                var selectedRow = popupFindInstance.getSelectedRowsData();
                if (selectedRow.length > 0)
                {
                    GetMonthlyTravelSheetByDocNum(selectedRow[0].DocNum);
                }
                $('#myModal_Find').modal('hide');
                $('body').removeClass('modal-open');
                $('.modal-backdrop').remove();

            });
            $("#docNumber").blur(function () {

                GetMonthlyTravelSheetByDocNum($("#docNumber").val());

            });

            $('#btnYes').click(function () {

                $("#myModal_Confirmation").modal('hide');

                loadPanel.show();

                var Year = $("#yearDropDown").dxSelectBox("instance").option('value');
                var Month = $("#monthDropDown").dxSelectBox("instance").option('value');
                var name = $(this).attr('_name');


               

                var url = "/MonthlyTravelSheet/RemoveImage";
                $.ajax({
                    url: url,
                    method: "POST",
                    cache: false,
                    data: {
                        year: Year,
                        month: Month,
                        fileName:name
                    },
                    async: false,
                    success: function (response) {
                        loadPanel.hide();
                        if (response.Success) {
                            var newImageTable = [];
                            var newFileValues = [];
                            var sno = 0;
                            $.each(ImageTable, function (index, val) {
                                if (val.Name != name) {
                                    sno = sno + 1;
                                    var Details = {
                                        SNo: sno,
                                        Name: val.Name
                                    };
                                    newImageTable.push(Details);
                                }
                            });

                            $.each($("#file-uploader").dxFileUploader("instance").option('value'), function (index, val) {
                                if (val.name != name) {
                                    newFileValues.push(val);
                                }
                            });
                            $("#file-uploader").dxFileUploader({ value: newFileValues });
                            ImageTable = newImageTable;;
                            GenerateImageGrid(ImageTable);
                            AlertToast('success', response.Message);
                            //setTimeout(function () {
                            //    window.location.reload();
                            //}, 5000);
                        }
                        else {
                            AlertToast('error', response.Message);
                        }
                    },
                    error: function (response) {
                        console.log(response);
                        loadPanel.hide();
                    },
                    failure: function (response) {
                        console.log(response);
                        loadPanel.hide();
                    }

                });


            });

           
        });

        $('body').on('click', '.btnRemoveDocument', function () {
            var name = $(this).attr('_name');

            $("#myModal_Confirmation").modal('show');
            $('#btnYes').attr('_name', name);
        });

        $('body').on('click', '.btnViewImage', function () {
            var imagepath = $(this).attr('_imagepath');
           
            window.open(
            imagepath,
            '_blank' 
            );
        });

</script>

